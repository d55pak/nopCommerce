name: DevSecOps
'on':
  push:
    branches:
      - develop
  pull_request:
    branches:
      - develop
  workflow_dispatch: null

jobs:
Build_Image_Docker:
    name: Build-Push-Image-Docker
    runs-on: ubuntu-latest
    needs:
      - SAST_Scan-NodeJs
    steps:
      - name: 'Build, tag, and push image to docker.io'
        env:
          IMAGE_TAG: '${{ github.sha }}'
        run: |
          docker build -t kumardineshwar/devsecops:$IMAGE_TAG .
          docker push kumardineshwar/devsecops:$IMAGE_TAG     
      - name: Checkout
        uses: actions/checkout@v2
      - uses: mr-smithers-excellent/docker-build-push@v5
        name: Build & push Docker image
        with:
          image: kumardineshwar/devsecops
          tags: 'v1, latest'
          registry: docker.io
          dockerfile: ./Dockerfile
          username: '${{ secrets.DOCKER_USERNAME }}'
          password: '${{ secrets.DOCKER_PASSWORD }}'
